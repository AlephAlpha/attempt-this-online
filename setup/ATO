#!/bin/sh -e
# Start script for the Attempt This Online server - to be run as root

# create lock directory
mkdir -p /run/lock/ATO
chown sandbox:sandbox /run/lock/ATO
chmod 750 /run/lock/ATO

# create control groups
cgcreate -a sandbox:sandbox -t sandbox:sandbox -g memory,cpu,pids:ATO

# initialise IPC directories
mkdir -p /run/ATO_i /run/ATO_o
chown api:api /run/ATO_i
chown sandbox:api /run/ATO_o
chmod 775 /run/ATO_i /run/ATO_o

sudo -u api /usr/local/lib/ATO/server
